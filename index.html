
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<meta name="theme-color" content="#ff7a00">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Kendime">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23ff7a00'/><text x='50' y='65' font-size='60' text-anchor='middle' fill='white' font-family='system-ui'>K</text></svg>">
<link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Kendime Not&quot;,&quot;short_name&quot;:&quot;Kendime&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;%23f7f7f7&quot;,&quot;theme_color&quot;:&quot;%23ff7a00&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23ff7a00'/><text x='50' y='65' font-size='60' text-anchor='middle' fill='white' font-family='system-ui'>K</text></svg>&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}]}">
<title>Kendime â€” Not</title>
<style>
  :root{--accent:#ff7a00;--bg:#f7f7f7;--fg:#111;--card:#fff;--muted:#666;--border:#e9e9e9;--success:#10b981;--warning:#f59e0b;--danger:#ef4444}
  *{box-sizing:border-box} body{margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg);transition:all 0.3s ease}
  header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--border);padding:10px 14px;display:flex;gap:10px;align-items:center;z-index:100;backdrop-filter:blur(10px)}
  .logo{width:36px;height:36px;border-radius:10px;background:var(--accent);color:#fff;display:grid;place-items:center;font-weight:700}
  .title{font-weight:700}
  .search{display:flex;gap:8px;flex:1;position:relative}
  .search input{flex:1;padding:10px 40px 10px 10px;border:1px solid #ddd;border-radius:999px;transition:all 0.2s}
  .search input:focus{border-color:var(--accent);outline:none;box-shadow:0 0 0 3px rgba(255,122,0,0.1)}
  .voice-btn{position:absolute;right:50px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:5px;border-radius:50%;transition:all 0.2s}
  .voice-btn:hover{background:rgba(255,122,0,0.1)}
  .voice-btn.listening{background:var(--danger);color:white;animation:pulse 1s infinite}
  @keyframes pulse{0%,100%{transform:translateY(-50%) scale(1)}50%{transform:translateY(-50%) scale(1.1)}}
  .wrap{max-width:1200px;margin:0 auto;padding:14px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.06);padding:12px;transition:all 0.2s}
  .card:hover{box-shadow:0 4px 16px rgba(0,0,0,.1)}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){.grid{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}}
  input,textarea,button,select{font:inherit}
  input,textarea,select{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;transition:all 0.2s}
  input:focus,textarea:focus,select:focus{border-color:var(--accent);outline:none;box-shadow:0 0 0 3px rgba(255,122,0,0.1)}
  button{padding:10px 12px;border:0;border-radius:10px;background:var(--fg);color:var(--bg);cursor:pointer;transition:all 0.2s}
  button:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.2)}
  .btn-primary{background:var(--accent);color:#fff}
  .btn-success{background:var(--success);color:#fff}
  .btn-warning{background:var(--warning);color:#fff}
  .btn-danger{background:var(--danger);color:#fff}
  .light{background:#eee;color:#111}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#eee;color:#111;font-size:12px;cursor:pointer;transition:all 0.2s}
  .pill:hover{background:var(--accent);color:#fff}
  .muted{color:var(--muted)}
  .note-card{position:relative;overflow:hidden}
  .note-card.pinned{border-left:4px solid var(--accent)}
  .note-card.archived{opacity:0.6}
  .color-picker{display:flex;gap:5px;margin:8px 0}
  .color-dot{width:20px;height:20px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
  .color-dot:hover,.color-dot.active{border-color:var(--fg);transform:scale(1.2)}
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin-bottom:12px}
  .stat-item{text-align:center;padding:10px;background:var(--card);border-radius:10px;border:1px solid var(--border)}
  .stat-number{font-size:24px;font-weight:700;color:var(--accent)}
  .sort-controls{display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
  .filter-tabs{display:flex;gap:4px;margin-bottom:12px;overflow-x:auto}
  .filter-tab{padding:8px 16px;border:1px solid var(--border);border-radius:20px;background:var(--card);cursor:pointer;transition:all 0.2s;white-space:nowrap}
  .filter-tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;z-index:1000;align-items:center;justify-content:center}
  .modal.show{display:flex}
  .modal-content{background:var(--card);border-radius:14px;padding:20px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto}
  .floating-btn{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:24px;cursor:pointer;box-shadow:0 4px 16px rgba(0,0,0,0.2);transition:all 0.3s;z-index:99}
  .floating-btn:hover{transform:scale(1.1)}
  .speech-status{position:fixed;top:80px;right:20px;padding:10px 15px;background:var(--card);border:1px solid var(--border);border-radius:10px;box-shadow:0 4px 16px rgba(0,0,0,0.1);display:none;z-index:99}
  .toast{position:fixed;top:20px;right:20px;padding:12px 16px;border-radius:10px;color:#fff;font-weight:500;z-index:1001;transform:translateX(400px);transition:all 0.3s}
  .toast.show{transform:translateX(0)}
  .toast.success{background:var(--success)}
  .toast.warning{background:var(--warning)}
  .toast.danger{background:var(--danger)}
  .note-content{white-space:pre-wrap;word-break:break-word}
  .edit-mode{border:2px solid var(--accent)}
  .keyboard-shortcuts{position:fixed;bottom:10px;left:10px;font-size:12px;color:var(--muted);background:var(--card);padding:8px;border-radius:8px;border:1px solid var(--border);opacity:0.7}
  
  /* Mobile optimizations */
  @media (max-width: 768px) {
    .wrap{padding:8px}
    .card{padding:8px}
    .row{gap:4px}
    .search input{font-size:16px}
    header{padding:8px 10px}
    .floating-btn{bottom:15px;right:15px;width:56px;height:56px;font-size:20px}
    .modal-content{padding:15px;width:95%}
    .filter-tabs{margin-bottom:8px}
    .filter-tab{padding:6px 12px;font-size:14px}
    .sort-controls{gap:4px;margin-bottom:8px}
    .keyboard-shortcuts{display:none}
    .voice-btn{padding:8px}
    .toast{right:10px;top:10px;left:10px;right:10px;transform:translateY(-100px)}
    .toast.show{transform:translateY(0)}
    button{min-height:44px;padding:12px}
    input,textarea,select{min-height:44px;font-size:16px}
    .note-card{margin-bottom:8px}
    .stats{grid-template-columns:repeat(2,1fr)}
  }
  
  /* Touch targets */
  .color-dot{width:32px;height:32px;margin:2px}
  .pill{min-height:32px;padding:8px 12px}
  
  /* Swipe gestures indicator */
  .swipe-hint{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:var(--card);padding:8px 16px;border-radius:20px;font-size:12px;color:var(--muted);border:1px solid var(--border);opacity:0.8;z-index:99}
  
  /* Haptic feedback simulation */
  .haptic-feedback{animation:haptic 0.1s ease}
  @keyframes haptic{0%{transform:scale(1)}50%{transform:scale(0.98)}100%{transform:scale(1)}}
</style>
</head>
<body>
<header>
  <div class="logo">K</div>
  <div class="title">Kendime</div>
  <form class="search" onsubmit="event.preventDefault();doSearch()">
    <input id="q" placeholder="Notlarda ara (Ctrl+F)" oninput="doSearch()">
    <button type="button" class="voice-btn" onclick="toggleVoiceSearch()" title="Sesli arama (Ctrl+Shift+V)">ğŸ¤</button>
    <button class="light" type="submit">Ara</button>
  </form>
  <button class="light" onclick="toggleTheme()" title="Tema deÄŸiÅŸtir">ğŸŒ“</button>
  <button class="light" onclick="showStats()" title="Ä°statistikler">ğŸ“Š</button>
</header>

<div class="wrap">
  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <div class="filter-tab active" onclick="setFilter('all')">TÃ¼mÃ¼</div>
    <div class="filter-tab" onclick="setFilter('pinned')">ğŸ“Œ SabitlenmiÅŸ</div>
    <div class="filter-tab" onclick="setFilter('archived')">ğŸ“ ArÅŸiv</div>
    <div class="filter-tab" onclick="setFilter('recent')">ğŸ•’ Son eklenenler</div>
  </div>

  <!-- Sort Controls -->
  <div class="sort-controls">
    <label>SÄ±ralama:</label>
    <select id="sortBy" onchange="render()">
      <option value="newest">En yeni</option>
      <option value="oldest">En eski</option>
      <option value="title">BaÅŸlÄ±k (A-Z)</option>
      <option value="updated">Son gÃ¼ncellenen</option>
    </select>
    <button class="light" onclick="exportNotes()" title="NotlarÄ± dÄ±ÅŸa aktar">ğŸ’¾ DÄ±ÅŸa Aktar</button>
    <input type="file" id="importFile" accept=".json" onchange="importNotes()" style="display:none">
    <button class="light" onclick="document.getElementById('importFile').click()" title="Not iÃ§e aktar">ğŸ“‚ Ä°Ã§e Aktar</button>
  </div>

  <!-- Add Note Form -->
  <div class="card" style="margin-bottom:12px">
    <div class="row">
      <input id="title" placeholder="BaÅŸlÄ±k (Ctrl+N ile hÄ±zlÄ± ekleme)">
      <input id="tags" placeholder="Etiketler (virgÃ¼lle ayÄ±r)">
      <select id="category">
        <option value="">Kategori seÃ§in</option>
        <option value="KiÅŸisel">ğŸ“ KiÅŸisel</option>
        <option value="Ä°ÅŸ">ğŸ’¼ Ä°ÅŸ</option>
        <option value="Fikir">ğŸ’¡ Fikir</option>
        <option value="GÃ¶rev">âœ… GÃ¶rev</option>
        <option value="Ã–nemli">â­ Ã–nemli</option>
      </select>
    </div>
    <textarea id="content" rows="4" placeholder="Not yazâ€¦ (Ses komutlarÄ±: 'not ekle', 'temizle', 'ara')"></textarea>
    
    <!-- Color Picker -->
    <div class="color-picker">
      <div class="color-dot" style="background:#fff" data-color="#fff" onclick="selectColor('#fff')"></div>
      <div class="color-dot" style="background:#fef3c7" data-color="#fef3c7" onclick="selectColor('#fef3c7')"></div>
      <div class="color-dot" style="background:#fed7d7" data-color="#fed7d7" onclick="selectColor('#fed7d7')"></div>
      <div class="color-dot" style="background:#c6f6d5" data-color="#c6f6d5" onclick="selectColor('#c6f6d5')"></div>
      <div class="color-dot" style="background:#bee3f8" data-color="#bee3f8" onclick="selectColor('#bee3f8')"></div>
      <div class="color-dot" style="background:#e9d8fd" data-color="#e9d8fd" onclick="selectColor('#e9d8fd')"></div>
    </div>
    
    <div class="row" style="justify-content:space-between;margin-top:8px">
      <div class="row">
        <button onclick="addNote()" class="btn-primary" title="Not ekle (Ctrl+Enter)">ğŸ“ Not ekle</button>
        <button class="light" onclick="clearForm()" title="Temizle (Esc)">ğŸ—‘ï¸ Temizle</button>
        <button class="voice-btn" onclick="startVoiceNote()" title="Sesli not (Ctrl+Shift+N)">ğŸ¤ Sesli Not</button>
      </div>
      <span id="count" class="muted"></span>
    </div>
  </div>

  <!-- Notes List -->
  <div id="list" class="grid"></div>
</div>

<!-- Floating Action Button -->
<button class="floating-btn" onclick="quickAdd()" title="HÄ±zlÄ± not (Ctrl+N)">+</button>

<!-- Speech Status -->
<div id="speechStatus" class="speech-status">
  ğŸ¤ Dinleniyor...
</div>

<!-- Statistics Modal -->
<div id="statsModal" class="modal">
  <div class="modal-content">
    <h3>ğŸ“Š Ä°statistikler</h3>
    <div id="statsContent"></div>
    <button onclick="closeModal('statsModal')" class="light" style="margin-top:15px">Kapat</button>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3>âœï¸ Notu DÃ¼zenle</h3>
    <input id="editTitle" placeholder="BaÅŸlÄ±k">
    <textarea id="editContent" rows="6" placeholder="Ä°Ã§erik"></textarea>
    <input id="editTags" placeholder="Etiketler">
    <select id="editCategory">
      <option value="">Kategori seÃ§in</option>
      <option value="KiÅŸisel">ğŸ“ KiÅŸisel</option>
      <option value="Ä°ÅŸ">ğŸ’¼ Ä°ÅŸ</option>
      <option value="Fikir">ğŸ’¡ Fikir</option>
      <option value="GÃ¶rev">âœ… GÃ¶rev</option>
      <option value="Ã–nemli">â­ Ã–nemli</option>
    </select>
    <div class="row" style="margin-top:15px">
      <button onclick="saveEdit()" class="btn-success">ğŸ’¾ Kaydet</button>
      <button onclick="closeModal('editModal')" class="light">âŒ Ä°ptal</button>
    </div>
  </div>
</div>

<!-- Mobile Swipe Hint -->
<div id="swipeHint" class="swipe-hint" style="display:none">
  ğŸ‘† Ä°pucu: NotlarÄ± kaydÄ±rarak sil
</div>

<!-- Keyboard Shortcuts Info -->
<div class="keyboard-shortcuts">
  âŒ¨ï¸ KÄ±sayollar: Ctrl+N (HÄ±zlÄ± not) | Ctrl+F (Ara) | Ctrl+Shift+V (Sesli arama) | Esc (Temizle)
</div>

<script>
const KEY = "kendime_notes_v2";
let notes = JSON.parse(localStorage.getItem(KEY) || "[]");
let query = "";
let currentFilter = "all";
let selectedColor = "#fff";
let editingId = null;
let recognition = null;
let isListening = false;
let touchStartX = 0;
let touchStartY = 0;
let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// PWA install prompt
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  showInstallBanner();
});

function showInstallBanner() {
  if (isMobile && deferredPrompt) {
    const installBanner = document.createElement('div');
    installBanner.innerHTML = `
      <div style="position:fixed;bottom:80px;left:10px;right:10px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;z-index:999;box-shadow:0 4px 16px rgba(0,0,0,0.1)">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:600">ğŸ“± UygulamayÄ± YÃ¼kle</div>
            <div style="font-size:12px;color:var(--muted)">Ana ekranÄ±na ekle</div>
          </div>
          <div class="row" style="gap:8px">
            <button onclick="installPWA()" class="btn-primary" style="padding:8px 12px;font-size:12px">YÃ¼kle</button>
            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="light" style="padding:8px 12px;font-size:12px">âœ•</button>
          </div>
        </div>
      </div>
    `;
    document.body.appendChild(installBanner);
    
    setTimeout(() => {
      if (installBanner.parentElement) {
        installBanner.remove();
      }
    }, 10000);
  }
}

function installPWA() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        showToast('Uygulama yÃ¼kleniyor! ğŸ“±', 'success');
      }
      deferredPrompt = null;
    });
  }
}

// Initialize speech recognition
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'tr-TR';
  
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript.toLowerCase();
    handleVoiceCommand(transcript);
  };
  
  recognition.onerror = function(event) {
    showToast('Ses tanÄ±ma hatasÄ±: ' + event.error, 'danger');
    hideVoiceStatus();
  };
  
  recognition.onend = function() {
    isListening = false;
    hideVoiceStatus();
    updateVoiceButton();
  };
}

// Utility functions
function save() { 
  localStorage.setItem(KEY, JSON.stringify(notes)); 
  render(); 
}

function uid() { 
  return Date.now().toString(36) + Math.random().toString(36).slice(2); 
}

function formatDate(timestamp) {
  return new Date(timestamp).toLocaleDateString('tr-TR', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
}

function escape(s) {
  return s.replace(/[&<>"']/g, m => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  }[m]));
}

// Note management
function addNote() {
  const t = title.value.trim();
  const c = content.value.trim();
  const g = tags.value.trim();
  const cat = category.value;
  
  if (!t && !c) {
    showToast("BoÅŸ not eklenemez", "warning");
    return;
  }
  
  // Add haptic feedback for mobile
  addHapticFeedback(event?.target);
  
  const note = {
    id: uid(),
    title: t,
    content: c,
    tags: g,
    category: cat,
    pinned: false,
    archived: false,
    color: selectedColor,
    ts: Date.now(),
    updated: Date.now()
  };
  
  notes.unshift(note);
  clearForm();
  save();
  showToast("Not eklendi! ğŸ“", "success");
}

function editNote(id) {
  const note = notes.find(n => n.id === id);
  if (!note) return;
  
  editingId = id;
  document.getElementById('editTitle').value = note.title || '';
  document.getElementById('editContent').value = note.content || '';
  document.getElementById('editTags').value = note.tags || '';
  document.getElementById('editCategory').value = note.category || '';
  
  showModal('editModal');
}

function saveEdit() {
  if (!editingId) return;
  
  const note = notes.find(n => n.id === editingId);
  if (!note) return;
  
  note.title = document.getElementById('editTitle').value.trim();
  note.content = document.getElementById('editContent').value.trim();
  note.tags = document.getElementById('editTags').value.trim();
  note.category = document.getElementById('editCategory').value;
  note.updated = Date.now();
  
  save();
  closeModal('editModal');
  showToast("Not gÃ¼ncellendi! âœ…", "success");
  editingId = null;
}

function removeNote(id) {
  if (confirm('Bu notu silmek istediÄŸinizden emin misiniz?')) {
    notes = notes.filter(n => n.id !== id);
    save();
    showToast("Not silindi! ğŸ—‘ï¸", "success");
  }
}

function togglePin(id) {
  const note = notes.find(n => n.id === id);
  if (note) {
    note.pinned = !note.pinned;
    note.updated = Date.now();
    save();
    showToast(note.pinned ? "Not sabitlendi! ğŸ“Œ" : "Not sabitleme kaldÄ±rÄ±ldÄ±!", "success");
  }
}

function toggleArchive(id) {
  const note = notes.find(n => n.id === id);
  if (note) {
    note.archived = !note.archived;
    note.updated = Date.now();
    save();
    showToast(note.archived ? "Not arÅŸivlendi! ğŸ“" : "Not arÅŸivden Ã§Ä±karÄ±ldÄ±!", "success");
  }
}

function duplicateNote(id) {
  const note = notes.find(n => n.id === id);
  if (note) {
    const newNote = {
      ...note,
      id: uid(),
      title: (note.title || '') + ' (Kopya)',
      ts: Date.now(),
      updated: Date.now()
    };
    notes.unshift(newNote);
    save();
    showToast("Not kopyalandÄ±! ğŸ“‹", "success");
  }
}

function clearForm() {
  title.value = "";
  content.value = "";
  tags.value = "";
  category.value = "";
  selectedColor = "#fff";
  updateColorPicker();
}

function selectColor(color) {
  selectedColor = color;
  updateColorPicker();
}

function updateColorPicker() {
  document.querySelectorAll('.color-dot').forEach(dot => {
    dot.classList.toggle('active', dot.dataset.color === selectedColor);
  });
}

// Search and filter
function doSearch() {
  query = q.value.toLowerCase();
  render();
}

function setFilter(filter) {
  currentFilter = filter;
  document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  render();
}

// Voice commands
function handleVoiceCommand(transcript) {
  hideVoiceStatus();
  
  if (transcript.includes('not ekle') || transcript.includes('kaydet')) {
    addNote();
  } else if (transcript.includes('temizle') || transcript.includes('sil')) {
    clearForm();
    showToast("Form temizlendi! ğŸ—‘ï¸", "success");
  } else if (transcript.includes('ara') || transcript.includes('bul')) {
    const searchTerm = transcript.replace(/ara|bul/g, '').trim();
    if (searchTerm) {
      document.getElementById('q').value = searchTerm;
      doSearch();
      showToast(`"${searchTerm}" aranÄ±yor...`, "success");
    }
  } else if (transcript.includes('yeni not')) {
    quickAdd();
  } else if (transcript.includes('tÃ¼mÃ¼') || transcript.includes('hepsi')) {
    setFilter('all');
  } else if (transcript.includes('sabitle') || transcript.includes('pin')) {
    showToast("Hangi notu sabitlemek istediÄŸinizi belirtin", "warning");
  } else {
    // If no command recognized, use as note content
    content.value = transcript;
    showToast("Ses metne dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼! âœï¸", "success");
  }
}

function startVoiceNote() {
  if (!recognition) {
    showToast("Ses tanÄ±ma bu tarayÄ±cÄ±da desteklenmiyor", "danger");
    return;
  }
  
  if (isListening) {
    recognition.stop();
    return;
  }
  
  isListening = true;
  showVoiceStatus();
  updateVoiceButton();
  recognition.start();
}

function toggleVoiceSearch() {
  if (!recognition) {
    showToast("Ses tanÄ±ma bu tarayÄ±cÄ±da desteklenmiyor", "danger");
    return;
  }
  
  if (isListening) {
    recognition.stop();
    return;
  }
  
  isListening = true;
  showVoiceStatus();
  updateVoiceButton();
  
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById('q').value = transcript;
    doSearch();
    showToast(`"${transcript}" aranÄ±yor...`, "success");
  };
  
  recognition.start();
}

function updateVoiceButton() {
  document.querySelectorAll('.voice-btn').forEach(btn => {
    btn.classList.toggle('listening', isListening);
  });
}

function showVoiceStatus() {
  document.getElementById('speechStatus').style.display = 'block';
}

function hideVoiceStatus() {
  document.getElementById('speechStatus').style.display = 'none';
}

// UI functions
function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => toast.classList.add('show'), 100);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => document.body.removeChild(toast), 300);
  }, 3000);
}

function showModal(modalId) {
  document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('show');
}

function quickAdd() {
  document.getElementById('title').focus();
  showToast("HÄ±zlÄ± not ekleme! âš¡", "success");
}

// Statistics
function showStats() {
  const total = notes.length;
  const pinned = notes.filter(n => n.pinned).length;
  const archived = notes.filter(n => n.archived).length;
  const categories = {};
  const tagStats = {};
  
  notes.forEach(note => {
    if (note.category) {
      categories[note.category] = (categories[note.category] || 0) + 1;
    }
    if (note.tags) {
      note.tags.split(',').forEach(tag => {
        const cleanTag = tag.trim();
        if (cleanTag) {
          tagStats[cleanTag] = (tagStats[cleanTag] || 0) + 1;
        }
      });
    }
  });
  
  const topTags = Object.entries(tagStats)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5);
  
  document.getElementById('statsContent').innerHTML = `
    <div class="stats">
      <div class="stat-item">
        <div class="stat-number">${total}</div>
        <div>Toplam Not</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">${pinned}</div>
        <div>SabitlenmiÅŸ</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">${archived}</div>
        <div>ArÅŸivlenmiÅŸ</div>
      </div>
    </div>
    
    <h4>ğŸ“Š Kategoriler</h4>
    ${Object.entries(categories).map(([cat, count]) => 
      `<div class="row" style="justify-content:space-between;margin:5px 0">
        <span>${cat}</span><span class="pill">${count}</span>
      </div>`
    ).join('') || '<p class="muted">HenÃ¼z kategori yok</p>'}
    
    <h4>ğŸ·ï¸ En Ã‡ok KullanÄ±lan Etiketler</h4>
    ${topTags.map(([tag, count]) => 
      `<div class="row" style="justify-content:space-between;margin:5px 0">
        <span>${tag}</span><span class="pill">${count}</span>
      </div>`
    ).join('') || '<p class="muted">HenÃ¼z etiket yok</p>'}
  `;
  
  showModal('statsModal');
}

// Import/Export
function exportNotes() {
  const dataStr = JSON.stringify(notes, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `kendime-notlar-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  URL.revokeObjectURL(url);
  showToast("Notlar dÄ±ÅŸa aktarÄ±ldÄ±! ğŸ’¾", "success");
}

function importNotes() {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedNotes = JSON.parse(e.target.result);
      if (Array.isArray(importedNotes)) {
        notes = [...importedNotes, ...notes];
        save();
        showToast(`${importedNotes.length} not iÃ§e aktarÄ±ldÄ±! ğŸ“‚`, "success");
      } else {
        showToast("GeÃ§ersiz dosya formatÄ±", "danger");
      }
    } catch (error) {
      showToast("Dosya okuma hatasÄ±", "danger");
    }
  };
  reader.readAsText(file);
}

// Theme
function toggleTheme() {
  const dark = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim() === '#121212';
  if (dark) {
    setVars('#f7f7f7', '#111', '#fff', '#666', '#e9e9e9');
  } else {
    setVars('#121212', '#eee', '#1e1e1e', '#aaa', '#333');
  }
  showToast(dark ? "AÃ§Ä±k tema! â˜€ï¸" : "Koyu tema! ğŸŒ™", "success");
}

function setVars(bg, fg, card, muted, border) {
  const root = document.documentElement.style;
  root.setProperty('--bg', bg);
  root.setProperty('--fg', fg);
  root.setProperty('--card', card);
  root.setProperty('--muted', muted);
  root.setProperty('--border', border);
}

// Render
function render() {
  const list = document.getElementById("list");
  let filtered = notes.filter(n => {
    const searchMatch = !query || (n.title + " " + n.content + " " + (n.tags || "") + " " + (n.category || ""))
      .toLowerCase().includes(query);
    
    switch (currentFilter) {
      case 'pinned': return searchMatch && n.pinned && !n.archived;
      case 'archived': return searchMatch && n.archived;
      case 'recent': return searchMatch && !n.archived && (Date.now() - n.ts < 7 * 24 * 60 * 60 * 1000);
      default: return searchMatch && !n.archived;
    }
  });
  
  // Sorting
  const sortBy = document.getElementById('sortBy').value;
  filtered.sort((a, b) => {
    if (a.pinned !== b.pinned) return b.pinned - a.pinned;
    
    switch (sortBy) {
      case 'oldest': return a.ts - b.ts;
      case 'title': return (a.title || '').localeCompare(b.title || '');
      case 'updated': return b.updated - a.updated;
      default: return b.ts - a.ts;
    }
  });
  
  document.getElementById('count').textContent = `${filtered.length} not`;
  
  list.innerHTML = filtered.map(n => `
    <div class="card note-card ${n.pinned ? 'pinned' : ''} ${n.archived ? 'archived' : ''}" 
         style="background:${n.color || '#fff'}">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="row">
          ${n.category ? `<span class="pill">${n.category}</span>` : ''}
          ${(n.tags || '').split(',').filter(t => t.trim()).slice(0, 2).map(tag => 
            `<span class="pill" onclick="searchTag('${tag.trim()}')">${tag.trim()}</span>`
          ).join('')}
        </div>
        <div class="row">
          <button class="light" onclick="togglePin('${n.id}')" title="${n.pinned ? 'Sabitlemeyi kaldÄ±r' : 'Sabitle'}">
            ${n.pinned ? 'ğŸ“Œ' : 'ğŸ“'}
          </button>
          <button class="light" onclick="editNote('${n.id}')" title="DÃ¼zenle">âœï¸</button>
          <button class="light" onclick="duplicateNote('${n.id}')" title="Kopyala">ğŸ“‹</button>
          <button class="light" onclick="toggleArchive('${n.id}')" title="${n.archived ? 'ArÅŸivden Ã§Ä±kar' : 'ArÅŸivle'}">
            ${n.archived ? 'ğŸ“¤' : 'ğŸ“'}
          </button>
          <button class="light" onclick="removeNote('${n.id}')" title="Sil">ğŸ—‘ï¸</button>
        </div>
      </div>
      
      <h4 style="margin:.3rem 0">${escape(n.title || 'BaÅŸlÄ±ksÄ±z')}</h4>
      <div class="note-content muted">${escape(n.content).slice(0, 200)}${n.content.length > 200 ? '...' : ''}</div>
      
      <div class="row" style="justify-content:space-between;margin-top:8px;font-size:12px">
        <span class="muted">ğŸ“… ${formatDate(n.ts)}</span>
        ${n.updated !== n.ts ? `<span class="muted">âœï¸ ${formatDate(n.updated)}</span>` : ''}
      </div>
    </div>
  `).join('');
}

function searchTag(tag) {
  document.getElementById('q').value = tag;
  doSearch();
  showToast(`"${tag}" etiketiyle arama yapÄ±lÄ±yor...`, "success");
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  // Ctrl+N - Quick add
  if (e.ctrlKey && e.key === 'n') {
    e.preventDefault();
    quickAdd();
  }
  
  // Ctrl+F - Focus search
  if (e.ctrlKey && e.key === 'f') {
    e.preventDefault();
    document.getElementById('q').focus();
  }
  
  // Ctrl+Shift+V - Voice search
  if (e.ctrlKey && e.shiftKey && e.key === 'V') {
    e.preventDefault();
    toggleVoiceSearch();
  }
  
  // Ctrl+Shift+N - Voice note
  if (e.ctrlKey && e.shiftKey && e.key === 'N') {
    e.preventDefault();
    startVoiceNote();
  }
  
  // Ctrl+Enter - Add note
  if (e.ctrlKey && e.key === 'Enter') {
    e.preventDefault();
    addNote();
  }
  
  // Escape - Clear form
  if (e.key === 'Escape') {
    clearForm();
  }
});

// Touch swipe functionality
document.addEventListener('touchstart', function(e) {
  if (e.target.closest('.note-card')) {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  }
}, { passive: true });

document.addEventListener('touchend', function(e) {
  if (!e.target.closest('.note-card')) return;
  
  const touchEndX = e.changedTouches[0].clientX;
  const touchEndY = e.changedTouches[0].clientY;
  const deltaX = touchStartX - touchEndX;
  const deltaY = Math.abs(touchStartY - touchEndY);
  
  // Horizontal swipe with minimum distance and not too much vertical movement
  if (Math.abs(deltaX) > 100 && deltaY < 50) {
    const noteCard = e.target.closest('.note-card');
    const noteId = noteCard.querySelector('[onclick*="removeNote"]')?.onclick.toString().match(/'([^']+)'/)?.[1];
    
    if (deltaX > 0 && noteId) { // Swipe left to delete
      noteCard.classList.add('haptic-feedback');
      setTimeout(() => {
        if (confirm('Bu notu silmek istediÄŸinizden emin misiniz?')) {
          removeNote(noteId);
        }
      }, 100);
    }
  }
}, { passive: true });

// Haptic feedback for mobile
function addHapticFeedback(element) {
  if (isMobile && 'vibrate' in navigator) {
    navigator.vibrate(10);
  }
  if (element) {
    element.classList.add('haptic-feedback');
    setTimeout(() => element.classList.remove('haptic-feedback'), 100);
  }
}

// Enhanced mobile voice recognition
if (isMobile && recognition) {
  recognition.continuous = true; // Better for mobile
  recognition.interimResults = true;
  
  let interimTranscript = '';
  recognition.onresult = function(event) {
    let finalTranscript = '';
    
    for (let i = event.resultIndex; i < event.results.length; i++) {
      if (event.results[i].isFinal) {
        finalTranscript += event.results[i][0].transcript;
      } else {
        interimTranscript = event.results[i][0].transcript;
      }
    }
    
    if (finalTranscript) {
      handleVoiceCommand(finalTranscript.toLowerCase());
    }
    
    // Show interim results
    if (interimTranscript && document.getElementById('speechStatus').style.display === 'block') {
      document.getElementById('speechStatus').innerHTML = `ğŸ¤ "${interimTranscript}"`;
    }
  };
}

// Click outside to close modals
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('modal')) {
    e.target.classList.remove('show');
  }
});

// Show swipe hint on mobile
if (isMobile && notes.length > 0) {
  setTimeout(() => {
    const hint = document.getElementById('swipeHint');
    hint.style.display = 'block';
    setTimeout(() => {
      hint.style.display = 'none';
    }, 3000);
  }, 2000);
}

// Initialize
updateColorPicker();
render();

// Welcome message
if (notes.length === 0) {
  showToast("Kendime'ye hoÅŸ geldiniz! ğŸ‰ Ä°lk notunuzu ekleyin.", "success");
}
</script>
</body>
</html>
